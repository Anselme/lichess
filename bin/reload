#!/bin/sh

show_run()
{
    echo "$*"
    $*
}

echo "--- Building bootstrap"
show_run bin/build_bootstrap.php

if [ ! -f lichess/config/config_local.yml ]; then
    echo "--- Creating local configuration file"
    show_run cp lichess/config/config_local.yml.dist lichess/config/config_local.yml
fi

for env in dev test; do

    echo "--- Clearing $env cache"
    show_run rm -rf "lichess/cache/$env/*"

    echo "--- Warming up $env cache"
    show_run php lichess/console --env=$env -v cache:warmup

    echo "--- Loading $env fixtures"
    show_run php lichess/console --env=$env -v doctrine:mongodb:data:load

    echo "--- Creating $env indexes"
    show_run php lichess/console --env=$env -v doctrine:mongodb:schema:create --index

done

echo "--- Creating assets symlinks"
show_run php lichess/console assets:install web --symlink

echo "--- All set."

