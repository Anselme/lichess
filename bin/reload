#!/bin/sh

# Show a cow saying something smart.
curl --connect-timeout 1 -s -f "http://lichess.org/fortune.php?cowsay=1" 2>/dev/null

echo "--- Building bootstrap"
bin/build_bootstrap.php

for env in dev test; do

    echo "--- Clearing $env cache"
    rm -rf lichess/cache/$env/*

    echo "--- Warming up $env cache"
    php lichess/console --env=$env -v cache:warmup

    echo "--- Loading $env fixtures"
    php lichess/console --env=$env -v doctrine:mongodb:data:load

    echo "--- Creating $env indexes"
    php lichess/console --env=$env -v doctrine:mongodb:schema:create --index

done

echo "--- Creating assets symlinks"
php lichess/console assets:install web --symlink

echo "--- All set."
